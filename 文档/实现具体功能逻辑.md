好的，下面我将以“如何实现这些 API 里的具体功能”为主线，结合你给的数据库设计和 openapi.yaml，详细说明每个接口的实现思路和关键步骤。  
**每个接口都包含：请求校验、核心业务逻辑、数据库操作、异常处理、返回数据**。  
如需某个接口的详细代码实现，可随时告知！

---

## 1. 用户相关

### 1.1 注册（POST /api/register）

**实现步骤：**
1. 校验邮箱格式、密码长度。
2. 查询 user 表，判断邮箱是否已注册。
3. 对密码加密（如 bcrypt）。
4. 插入 user 表，写入邮箱、加密密码、激活状态等。
5. 返回注册成功或失败信息。

---

### 1.2 登录（POST /api/login）

**实现步骤：**
1. 校验邮箱、密码格式。
2. 查询 user 表，获取用户信息。
3. 校验密码（加密比对）。
4. 生成 JWT token。
5. 返回 token。

---

### 1.3 获取个人信息（GET /api/profile）

**实现步骤：**
1. 解析 JWT，获取 user_id。
2. 查询 user 表，返回用户信息（不含密码）。

---

### 1.4 修改个人信息（PUT /api/profile）

**实现步骤：**
1. 解析 JWT，获取 user_id。
2. 校验新密码格式。
3. 对新密码加密，更新 user 表。
4. 返回修改结果。

---

## 2. 会员相关

### 2.1 获取会员信息（GET /api/membership）

**实现步骤：**
1. 解析 JWT，获取 user_id。
2. 查询 membership 表，获取 local/online 会员信息。
3. 返回会员类型、到期时间、存储空间等。

---

## 3. 卡密相关

### 3.1 卡密兑换（POST /api/redeem）

**实现步骤：**
1. 解析 JWT，获取 user_id。
2. 校验卡密格式，查询 card_code 表，判断卡密是否存在、未用、类型是否匹配。
3. 根据卡密类型，更新 membership 表（本地会员延长一年/线上会员增加10G和一年时长，叠加）。
4. 更新 card_code 表为已用，记录 used_by、used_at。
5. 写入 card_code_log 表，记录使用动作。
6. 返回兑换结果。

---

## 4. 通知相关

### 4.1 获取通知列表（GET /api/notifications）

**实现步骤：**
1. 解析 JWT，获取 user_id。
2. 查询 user_notification 表，联查 notification 表，获取该用户的通知列表。
3. 返回通知内容、已读状态等。

---

### 4.2 标记通知为已读（PUT /api/notifications/{id}/read）

**实现步骤：**
1. 解析 JWT，获取 user_id。
2. 查询 user_notification 表，确认该通知属于该用户。
3. 更新 is_read、read_at 字段。
4. 返回操作结果。

---

## 5. 管理后台相关

### 5.1 管理员登录（POST /api/admin/login）

**实现步骤：**
1. 校验账号、密码格式。
2. 查询 admin 表，校验密码。
3. 生成管理员 JWT。
4. 返回 token。

---

### 5.2 批量生成卡密（POST /api/admin/card-codes）

**实现步骤：**
1. 校验管理员权限。
2. 生成指定数量、类型、面值的唯一卡密。
3. 批量插入 card_code 表。
4. 返回生成的卡密列表。

---

### 5.3 查询卡密列表（GET /api/admin/card-codes）

**实现步骤：**
1. 校验管理员权限。
2. 分页查询 card_code 表，返回卡密信息。

---

### 5.4 查询卡密使用记录（GET /api/admin/card-codes/{code}/logs）

**实现步骤：**
1. 校验管理员权限。
2. 查询 card_code_log 表，返回指定卡密的使用记录。

---

### 5.5 查询会员列表（GET /api/admin/memberships）

**实现步骤：**
1. 校验管理员权限。
2. 分页查询 membership 表，返回会员信息。

---

### 5.6 查询会员详情（GET /api/admin/memberships/{user_id}）

**实现步骤：**
1. 校验管理员权限。
2. 查询 membership 表，返回指定用户的会员详情。

---

### 5.7 管理员手动续费/调整会员（POST /api/admin/memberships/{user_id}/renew）

**实现步骤：**
1. 校验管理员权限。
2. 校验参数（类型、时长、存储）。
3. 更新 membership 表，写入 card_code_log（动作为“后台续费”）。
4. 返回操作结果。

---

### 5.8 获取统计数据（GET /api/admin/statistics）

**实现步骤：**
1. 校验管理员权限。
2. 统计用户数、会员数、卡密使用数等。
3. 返回统计数据。

---

## 6. 依赖与通用实现

- **JWT 校验**：所有需要登录/鉴权的接口，需先校验 JWT，获取 user_id/admin_id。
- **密码加密**：注册、修改密码、登录时，均需用同一加密算法。
- **数据库事务**：如卡密兑换、后台续费等涉及多表更新的操作，需用事务保证一致性。
- **异常处理**：所有接口需捕获异常，返回统一错误码和信息。

---

如需某个接口的详细伪代码或 Python/FastAPI/Flask/SQLAlchemy 实现模板，请告诉我接口名或模块！